@startuml Context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
!define osaPuml https://raw.githubusercontent.com/Crashedmind/PlantUML-opensecurityarchitecture2-icons/master

!include osaPuml/Common.puml
!include osaPuml/User/all.puml
!include <office/Servers/application_server>
!include <office/Services/web_services>
!include <office/Concepts/application_generic>
!include <office/Concepts/service_application>
!include <office/Servers/web_server>
!include <office/Communications/queue_viewer>
!include <office/Concepts/clock>
!include <office/Concepts/tasks>
!include <tupadr3/dev2/python>
!include <tupadr3/material/local_library>

AddPersonTag("user", $sprite="osa_user_audit,color=yellow", $legendSprite="osa_user_audit,scale=0.25,color=yellow", $legendText="Repository Admins", $bgColor=Gray)

AddContainerTag("rest_api", $sprite="web_server", $legendText="Repository REST API")
AddContainerTag("queue", $sprite="queue_viewer", $legendText="Message Queue")
AddContainerTag("scheduler", $sprite="clock", $legendText="Scheduler for tasks")
AddContainerTag("tasks", $sprite="tasks", $legendText="Celery Tasks Publisher")
AddComponentTag("python", $sprite="python", $legendText="Python Application")
AddComponentTag("service", $sprite="python", $legendText="Python Application")
AddContainerTag("storage_service", $sprite="file_server", $legendText="Storage Service", $bgColor=Gray)
AddContainerTag("key_service", $sprite="lock_with_key_security", $legendText="Key Service", $bgColor=Gray)

Person(user, "User", "User with granted access")

Boundary(kaprien_rest_api, "KAPRIEN-REST-API"){
    Component(api, "FastAPI", "Python"){
        Container(api_bootstrap, "bootstrap", $tags="rest_api")
        Container(api_targets, "targets", $tags="rest_api")
        Container(api_repo_settings, "repository_settings", $tags="rest_api")
        Container(api_token, "token", $tags="rest_api")
    }
}

Container(broker, "Broker", "Message Queue", $tags="queue") #Grey


HIDE_STEREOTYPE()

@enduml